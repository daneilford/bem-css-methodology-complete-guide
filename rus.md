# b_ БЭМ CSS методология: Полное руководство

Главное: классы `b-someblock__someelement__element__element-modificator` - это не БЭМ!
Большинство не знает что такое БЭМ, или думает, что знает, но ошибается. Если вы считаете, что он не для вас (или вообще только Яндексу нужен) — дочитайте до конца.

# Структура курса:
## Презентация #1 — ввод в теорию
### 1. Описание предметной области и проблемы:
### 2. Экскурс в историю
### 3. Методология, базовые понятия
### 4. Разница между методологией, реализацией и диалектами.
### 5. Альтернативы
### 6. Домашнее задание
### 7. Вопросы

## Презентация #2 — много практики и разбора ошибок
## 1. Best practices (код)
### 1.1 Примеры решения типовых задач и разбор типичных ошибок
### 1.2 Углубление в способы модификации
## 2. Tools и инфраструктура (Jade, Sass,  gulp, etc)
## 3. Разбор ответов

## Презентация #1 — ввод в теорию
### 1. Описание предметной области и проблемы:
_~10 слайдов, ~10 минут, цитаты, примеры, код_

Да это вода, но нужно убедить слушателей «зачем это вообще всё», иначе они дальше не будут слушать. Особенно это важно на фоне довольно сильно отрицательного бэкграунда у «БЭМ» как заумной сложной методологии, отрицающей базовые идеи CSS.

**1.1 Сами задаём вопрос и сами отвечаем — зачем вообще нужны методологии, почему недостаточно просто писать CSS.**
Ответ — писать на CSS легко, сложно поддерживать и развивать код.

Легко заменять разработчиков! :)
Нет проблемы ухода сотрудника в отпуск или непонятности его кода.
Даже лендинги удобно верстать по BEM - меньше думаешь над именами классов, нет конфликтов, легко поддерживать, расширять.

Суть БЭМ в том чтобы сделать ваш код прозрачней и понятней. БЭМ показыват разработчикам как классы относятся один к одному,
что особенно полезно в сложных или глубоких частях DOM. Например, если бы я попросил вас удалить все классы относящиеся к юзеру в этом куске кода,
какие бы вы выбросили?
Наверное вы бы начали с `user`, но обо всем остальное вы должны были бы догадываться, изучать или пытаться разобраться как-то ещё.

Что в этом коде относится к классу `user`?
```html
<div class="media user premium">
  <img class="img photo avatar" src="" />
  <p class="body bio">...</p>
</div></code>
```

Если мы перепишем этот код на BEM CSS, то все будет понятно просто из имён классов!
```html
<div class="media user--premium">
  <img class="media__img user__photo avatar" src="" />
  <p class="media__body user__bio">...</p>
</div>
```

##Семантика БЭМ
БЭМ всегда ругали за то что он ужасный и «для роботов», а на самом деле он довольно семантичный.

```html
<input class="big_red_button order-button">
```
Раньше мы писали „big-red-button“ (для кнопки покупки) и стало хорошим тоном чтобы название класса отображало не его представление, а его суть, это назвали семантикой, а класс переименовали в например, а „order-button“. Такой код стало легче поддерживать.
А БЭМ дополняет это, создавая новый уровень логики, где БЭМ описывает связи между элементами.
```html
<input class="order-button b-checkout__submit">
```
Т.е. обычно имена классов описывают конкретные кусочки, что из себя представляет каждый блок, а БЭМ описывает связи между блоками, положение этого блока в логике документа, это и есть дополнительный уровень семантики.


**Имена БЭМ-классов создают дополнительный уровень логики.**

##Зачем нужен БЭM?
БЭМ придумали в Яндексе для решения собственных проблем по поддержке огромного Яндекс-портала. Он был решением проблемы поддерживать html-код легко и быстро.
Нам БЭМ нужен т.к он удобен для верстки и позволяет не думать о именах классов, ликивидирует конфликты в коде, код легче расширять.
Также благодаря тому что БЭМ это методология — она позволяет легче вводить людей в проекты и заменять их. Нет проблемы ухода сотрудника в отпуск или непонятности его кода.


##БЭМ CSS
Ручная верстка по БЭМ называется «БЭМ CSS». Точнее официльного названия нет, я предлагаю такое.
Яндекс предлагает именовтаь его как «CSS подмножество БЭМ», потому что БЭМ он не только про CSS, это огромная методология, вершиной которой является Full Stack БЭМ с БЭМjson, БЭМtools и т.д:

Причина — CSS не был предназначен для создания сложного UI.
Аналогия с программированием: одна область видимости, нет ООП, вместо ада goto — ад каскада.

Каскад мощный инструмент — но не должен быть единственным, картинка с игрой Джанга.
Главная проблема вёрстки: каскад.
Зачем был придуман БЭМ? Чтоб уйти от каскада.
Почему надо уходить от каскада?
Идея убрать каскад кажется дикой - как, это же каскад. У нас каскадные таблицы стилей! Каскад сверху до низу по всей странице! Мы в 2000-х соревновались — «кто напишет меньше тегов»!
Но. У нас страница состоит из блоков. Её части НЕ есть один большой текст, со стилями что спускаются вниз. Это блоки, что могут и должны иметь возможность переноситься.

**1.2. Вопрос — Как это можно решить?**
Ответ что препроцессоры, линтеры и развитие самого CSS (разные способы изоляции стилей) это не решат.
Нужна методология, так же как и в программировании.
Об этом и поговорим.

### 2. Экскурс в историю
_~5 слайдов, фото, названия, красиво ярко, пару цитат из твиттера ~10 мин_

**2.1 Тут мы доносим ситуацию на рынке: как разные люди независимо друг от друга пришли к одному и тому же.**
Рассказывает как и кто эту проблему пытались решить методологиями:
 - Вначале был **OOCSS** (2007 год).
   Идеи, почему оказался нежизнеспособен (попытки реализовать логику без препроцессоров завязывались на ограничения языка, из инструментов по сути только каскад и в итоге мы получали да - логичную красивую структуру, но очень сложную и с дикими каскадами), но дал жизнь линтерам (CSSLint) и идеям структурирования кода. Идеи: один код - разное представление, универсальный код по всему сайту.
   MediaObject.
   Пример - моя верстка Knigafund, где один html-код и разный вид на разный страницах, сложный каскад, красиво, но неудобно поддерживать. Пример - как этот код переделан сейчас.
 - Паралельно в 2007 стартовали «Независимые блоки», они же позже **«АНБ»** у Харисова.
   К 2009-2010 это уже вылилось в стройную систему **БЭМ**.
 - Опять таки паралельно в 2011 Джонатан Снук придумывает **SMACSS**, который по сути является вариацией БЭМ.

**2.2 Движение не останавливается, сейчас каждые пару месяцев кто-то придумывает очередную методологию:**
MCSS, SUIT, Systematic CSS, ECSS, FUN… — которые все — просто вариации БЭМ.
Возникает вопрос - почему всё так запутано? Вот для этого и лекции.

Я прошел следующие стадии знакомства с БЭМ:
1. Не понимание: «что за ерунда придуманная программистами, которые не знают CSS». Нет не программистами. И не ерунда.
2. Иллюзия понимания: «[_независимые_ стили с селекторами в ширину экрана][1]».
3. Не знание того, как же правильно его применять, особенно в рамках веб-студии.

Существует огромное кол-во статей, докладов, презентаций про БЭМ. Почти все - от Яндекса. Но в них очень много теории и очень мало практики (она там заканчивается на примитивных примерах: сделаем меню, сделаем кнопку). Возникает куча практичских вопросов, а нормальной документации —  нет. Вообще если бы было меньше бредовых статей типа этой: «[Верстка для самых маленьких. Верстаем страницу по БЭМу][2]», которые пишут те, кто сам ничего не понял, было бы лучше. И ошибок было бы меньше.

Чтобы их осознать, мы с вами должны вспомнить как писать правильно. Вспомнить правила.
Я говорю «вспомнить», потому что то о чем мы будем говорить - это ручная верстка по БЭМ.
В правильных терминах БЭМ это называется «CSS подмножество БЭМ».
Потому что БЭМ он не только про CSS.

Нам придётся совершить экскурс в историю и пройти путь развития БЭМ чтобы сформулировать четкие правила «БЭМ CSS» из общей методилогии.
Чтоб собрать все пришлось читать старые посты на Я-ру (форуме Яндекса где описывалась разработка БЭМ) и очень много общаться с Яндекс-team и арторами методологии. Проблема в том что БЭМ - это идея, тут нет единого стандарта. Есть множество толкований = диалектов БЭМ. Доклады от авторов, презентации на внутренных коференциях, статьи других евангелистов-БЭМ. Сам БЭМ допускает множество вариантов самой методологии. А уж какой путь выбирать в каждом конкретном случае, при модификации кода например - решение автора кода. Давайте разберем примеры и варианты.

### 3. Методология, базовые понятия
_~50 слайдов, ~30 минут_

Разбираем с основ, как если бы люди не знали о чем речь, т.к. это у нас не доклад, а учебная лекция.

**3.1 Сразу делаем упор что БЭМ - это про декомпозицию на блоки**
А не про нейминг или про тулзы. Что нейминг и тулзы вообще не имею никакого значения.

**3.2 Понятие БЭМ-дерева.**
Есть DOM-дерево, а есть БЭМ-дерево.

##DOM-дерево
```html
<ul>
  <li>
    <a>
      <span></span>
    </a>
  </li>
</ul>
```

```css
.ul {}
.ul > li {}
.ul > li > a {}
.ul > li > a > span {}
```

Вложенные html-элементы - это DOM-дерево.
Имена классов, которые вы пишите - это БЭМ-дерево.
Почувствуйте разницу!

##БЭМ-дерево
```html
<ul class="menu">
  <li class="menu__item">
    <a class="menu__link">
      <span class="menu__text"></span>
    </a>
  </li>
</ul>
```

```css
.menu {}
.menu__item {}
.menu__link {}
.menu__text {}
```

##БЭМ дерево — чистая логика
Оно не зависит ни от чего, даже от размещения в документе.
БЭМ-дерево не привязано к визуальному представлению блоков, оно отображает только логику, это и есть новый уровень семантики!


**3.3 Основы БЭМ: базовая теорию, то что рассказывает Яндекс**
Но в примеры берём не примитивный стадартный пример «меню» и «кнопки», а главную страницу EPAM и раскладываем её.

#### Главные правила БЭМ.
##### .block

Главное в БЭМ - понятие независимого блока.

##.block
![.block](http://delka.github.io/talks/webcamp/2015/БЭМ/pictures/block.png)

__Независимый блок__
>НБ или просто блок, это самодостаточный элемент страницы, который при перемещении в другое место на странице или на другую страницу не теряет своей самодостаточности.

БЭМ.Форум, [Независимый блок](https://ru.БЭМ.info/forum/-43/)

__Правила независимости блока__
>1. для описания элемента используется class, но не id
>2. каждый блок имеет префикс
>3. в таблице стилей нет классов вне блоков

БЭМ.Форум, [История создания БЭМ](https://ru.БЭМ.info/forum/-147/)

Формальное определение нужно только затем чтоб описать при каких условиях он должен таким стать.
Что такое стили вне блоков я опишу ниже.

__"Как его таким написать?"__
Просто писать стили тупо на каждый блок. БЭМ хорош тем, что позволяет не забивать голову ерундой с каскадом, а сосредоточимся на семантике и логике кода. А с препроцессорами БЭМ позволяет писать еще и очень чистый и логичный код. Но про это чуть позже.

__Как проверить?__
Просто навести на блок в инспекторе кода. У него не должно быть каскада.
Слайд инспектор кода

##.block__element
![.block__element](http://delka.github.io/talks/webcamp/2015/БЭМ/pictures/element.png)

__Элемент__
>Элемент – это часть блока, отвечающая за отдельную функцию.
>_Он может находиться только в составе блока и не имеет смысла в отрыве от него._

БЭМ.info, [Методология](https://ru.БЭМ.info/method/definitions)

Элемент можно представить себе как папку в файловой системе, это способ организации кода, чтобы было понятно, что к чему относится.

##Самая страшная ошибка — .block__el__el__el

Не бывает элементов вложенных в элементы!

Я тоже раньше так писал:
```css
.form-buy-results__to-city__slider__tab__column_buy
```
Так делать нельзя.

Так #b_ поняли и используют зарубежом
![block__el__el](http://delka.github.io/talks/webcamp/2015/БЭМ/pictures/block__el__el.png)

__Как надо?__
```html
<div class='block'>
  <div class='block__elem1'>
    <div class='block__elem2'></div>
  </div>
  <div class='block__elem3'></div>
</div>
```

А в CSS:
```css
.block {}
.block__elem1 {}
.block__elem2 {}
.block__elem3 {}
```

__Если вам нужно сделать элемент у элемента, значит вам нужно сделать новый блок!__
Вместо:
```html
<div class='block'>
    <div class='block__elem1'>
        <div class='block__elem1__elem2'></div>
    </div>
</div>
```
Надо делать новый блок
```html
<div class='block1'>
    <div class='block2'>
        <div class='block2__elem'></div>
    </div>
</div>
```

##element > element нельзя в CSS, но можно в HTML!
Обратите внимание - вы не можете вкладывать элементы в элементы в CSS, но можете и должны вкладывать элементы в элементы в HTML! DOM-дерево и БЭМ-дерево могут быть разными.

##Запрет есть исключительно про нейминг!
>БЭМ-дерево на то и дерево, что поддерживает вложенность, поэтому в БЭМ-дереве, разумеется, разрешается вкладывать элементы в элементы, блоки в блоки, блоки в элементы.

Vladimir Grinenko, [@tadatuta](http://twitter.com/tadatuta)

##### Модификатор
Модификаторы в #yandex #b_:
```css
.block-name__elem_key_value
```

Но для всего мира ([csswizardry](http://csswizardry.com/2013/01/mindБЭМding-getting-your-head-round-БЭМ-syntax/),[cssguidelin](http://cssguidelin.es/#БЭМ-like-naming),[sitepoint](http://www.sitepoint.com/БЭМ-smacss-advice-from-developers/)) это:
```css
.blockname__elem--mod {}
```
Синтаксис модификаторов `.blockname__elem--mod` был запущен в 2012 с легкой руки Nicolas Gallagher @necolas в http://nicolasgallagher.com/about-html-semantics-front-end-architecture/
Причина:
> This is merely a naming pattern that I’m finding helpful at the moment. It could take any form. But the benefit lies in removing the ambiguity of class names that rely only on (single) hyphens, or underscores, or camel case.
> http://nicolasgallagher.com/about-html-semantics-front-end-architecture/

> The reason for double rather than single hyphens and underscores is so that your block itself can be hyphen delimited, for example:
> http://csswizardry.com/2013/01/mindБЭМding-getting-your-head-round-БЭМ-syntax/

###### Сокращённые модификаторы

Вариацией модификаторов являются "Сокращенные модификаторы" через multiple classes

```html
 <div class="blockName -mod_val"></div>
```
```scss
.blockName {
  &.-mod_val {}
}
```
Синтаксис с "-", а не с "_", т.к. иначе имя класса будет не валидно.

Стили модификаторов НЕ пишутся без привязки к имени блока
То что в Классическом БЭМ пишется как `.block_mod_val {}`
в сокращенных модификаторах пишут как `.block.-mod_val {}`

Компании и разработчики, которые используют сокращённые модификаторы:
* [Dan Tello "Sassier (BE)Modifers"](http://viget.com/extend/БЭМ-sass-modifiers)
* [iDeus Team](https://github.com/ideus-team/guidelines/blob/master/frontend/БЭМ.md)
* [2Gis](https://twitter.com/Chaptykov/status/570587770432962561)
* [Одноклассники](https://twitter.com/from_anywhere/status/570602747915059200)

Проблемы с сокращенными модификаторами:
 - Если у вас генерация html кода
 - Если у вас миксование блоков с модификаторами: http://codepen.io/hudochenkov/pen/OPEMwK?editors=110
 - Доводы от БЭМ-team: http://getБЭМ.com/faq/#why-the-modifier-classes-are-prefixed
 - "когда ты начнёшь использовать i-БЭМ.js и добавлять/удалять модификаторы динамически, ты поймёшь, что сокращённая запись этому мешает" (c) harisov https://twitter.com/harisov/status/571191436315631616

#### Префикс b- и его воображаемые друзья: `l-`,`i-`,`g-` и `js-` которого на самом деле не было

### 4. Разница между методологией, реализацией и диалектами.
_~100 слайдов, ~30 минут_

**4.1 Объясняем что есть методология БЭМ, а есть конкретные реализации**
В разных инструментах: можно в CSS, можно в Jade, можно в BEMJSON, можно собирать в ENB, а можно Gulp и т.д.

**4.2 Что реализации могут отличаться неймигом и даже тем по каким правилам писать код.**

**4.3 Рассказываем про диалекты:**
Главный синтаксис — не от Яндекса, а от Гарри Робертса.
  - bem.info — теория и реализация Яндекса
  - getbem.com — теория простыми словами и самая популярная реализация (Гарри)
  - **АНБ**: много разных префиксов, глобальные модификаторы, js-префиксы (которые c-)… (Яндекс 2007-2009)
  - **bem-bl**: минимум префиксов, абстрактные блоки, уровни переопределения, темы (как в SMACSS)… (Яндекс 2009-2012)
  - **Full Stack BEM** (Яндекс 2012 — сейчас)
  - **Full Stack в HTML**
  - **BEMIT**: пространства имен и состояния (как в SMACSS)
  - **BEViS**: без миксов
  - **Диалекты**: просто упомянуть OPOR, MCSS, SUIT, Systematic CSS, FUN, ECSS — как личные вариации авторов
  - **Вариации синтаксиса**:
    * сокращенные модификаторы
    * неважное: camelCase, разные виды разделителей, префиксы
  - Реализация как фреймворк: Google MDL

Не разбираем сильно подробно всё это (это можно часами разбирать, просто даём понятие и ссылки где почитать про каждое отдельно).

Останавливаемся на JS-классах, что это микс js-блока и css-блока, о разнице с i-bem.js

### 5. Альтернативы
_~5 слайдов, 5 минут_
Проговаривает альтернативы БЭМ:
По сути это только **Atomic CSS** и близкие к нему идеи (**React**), т.к. всё остальное — вариации на тему БЭМ.

### 6. Домашнее задание
Переверстать epam.com (общую раскладку)

### 7. Вопросы
_~30 минут_

## Презентация #2 — много практики и разбора ошибок
## 1. Best practices (код)
### 1.1 Примеры решения типовых задач и разбор типичных ошибок
_~100 слайдов, ~30 минут_
Позиционирование блоков, миксование, врапперы.
Берем из доклада http://ihorzenich.github.io/talks/2015/frontendweekend-bem/ , слайды №50—124

### 1.2 Углубление в способы модификации
_~30 слайдов, 30 минут_
Как менять внешний вид блока: 6 видов модификации:
  - Модификатором
    - модификатором блока
    - модификатором элемента
  - Контекстом (т.е. каскадом от блока выше)
  - Уровнем переопределения (добавлением-перезаписью файла стилей)
  - Миксованием (добавлением классов других блоков)
    - включая глобальный класс
- **Модификация контекстом** (каскад) — как и когда правильно
- В продолжение темы наследования — как реализовывать его правильно (через препроцессоры)
- **абстрактные блоки**, из реализация в препроцессорах
- **Уровни переопредения**

## 2. Tools и инфраструктура (Jade, Sass,  gulp, etc)
_~15 слайдов, 30 минут_
  - Файловые системы
  - Глобальные модификаторы
  - Позиционирование — про блоки-обертки на основе моих комментов в топике про обертки и обсуждения
  - БЭМ и Sass
  - БЭМ и Stylus
  - БЭМ-сетка
  - БЭМ и Jade = BEMto
  - БЭМ и PostCSS
  - БЭМ и Gulp
  - Яндекс-инструменты и Full Stack
  - Full Stack BEM в HTML

## 3. Разбор ответов
Тех, что уже успел получить на домашнее задание
_слайды с примерами ДЗ, ~30 минут_


# Отдельные темы
3. Три главных правила
4. Ошибки, про которые нигде не написано
5. Типичные вопросы, ответов на которые вы не нашли на БЭМ.info
6. Альтернативы или же братья: SMASS, OOCSS, MCSS и БЭМ.
7. Семантика в БЭМ.
8. БЭМ и CSS-препроцессоры: Sass и LESS.
9. Путь Яндекса: кому и зачем нужны БЭМ-tools и прочие "ужасы"
10. БЭМ-bl и БЭМ-bl в сниппетах от Яндекса (скоро!)
11. Альтернативные реализации БЭМ-методологии
12. Примеры сайтов на БЭМ
- Яндекс-сайтов по БЭМ
- НЕ-Яндекс-сайтов по БЭМ
- Редизайна по БЭМ
13. Отзывы: Мнения людей меняется за пару месяцев работы с БЭМ. Путь к пониманию.
14. Почему БЭМ это не религия


## Что не является БЭМ.
НЕ БЭМ:
- длинные строки каскада ради высокой специфичности селекторов - это не та независимость и ни разу не БЭМ.
- базовые стили и их переопределения ниже _от_контекста_ - как общий стиль вёрстки
- БЭМ это не только БЭМ-json, БЭМ-tools и прочее. АНБ - тоже БЭМ

## Сравнение Сокращённых модификаторов и BEViS состояний
...
Код от Гарри со стравнением

## Абстрактные блоки
Абстрактный блок = блок который является основой других блоков, но сам не существует в верстке без миксования с другми.
Тут ещё формальные определения из Ярушки и примеры.

## Разница между модификатором и абстрактным блоком
Модификаторы - изменяют или дополняют уже существующий блок. Они нужны тогда когда у вас есть _уже готовый блок_, который _не сильно_ изменяется и это реализовывается модификаторами.
А абстрактные блоки - это кирпичи для _ещё не построенного блока_, с их помощью можно построить _значительно отличающиеся_ блоки.

Итого - если вам надо:
 * набор похожих блоков - модификаторы
 * набор сходных, но непохожих блоков - абстрактные классы


## Префикс b- и его воображаемые друзья: l-,i-,g- и еретический js-
А префикс js- (недолго существовавший как с- в #b_) вероятно тоже популяризировал Nicolas Gallagher @necolas в той же статье http://nicolasgallagher.com/about-html-semantics-front-end-architecture/


## Привязка к блоку-родителю
https://twitter.com/delaz/status/580353955244482560

## БЭМ и CSS-препроцессоры: Sass и LESS.
Extend-Only Selectors в Sass == абстрактный блок (i-блок) в #b_
```SCSS
%i-block {
  // стили абстрактного блока
}
.b-block {
  @extend %i-block;
}
```

[1]: http://delka.name/blog/2013/04/БЭМ-otkroveniya-prinyavshih-veru/
[2]: http://habrahabr.ru/post/203440/
[3]: http://clubs.ya.ru/БЭМ/replies.xml?item_no=4
